#region File Description
//-----------------------------------------------------------------------------
// MainForm.cs
//
// Microsoft XNA Community Game Platform
// Copyright (C) Microsoft Corporation. All rights reserved.
//-----------------------------------------------------------------------------
#endregion

#region Using Statements
using System;
using System.IO;
using System.Reflection;
using System.Windows.Forms;

using Microsoft.Xna.Framework.Content;
using Microsoft.Xna.Framework.Graphics;
using XNABuilder;
using XNASysLib.XNAKernel;
using Microsoft.Xna.Framework.Input;
using XNASysLib.XNATools;
#endregion

namespace WinFormsContentLoading
{
    /// <summary>
    /// Custom form provides the main user interface for the program.
    /// In this sample we used the designer to fill the entire form with a
    /// ModelViewerControl, except for the menu bar which provides the
    /// "File / Open..." option.
    /// </summary>
    public partial class MainForm : Form
    {
        ContentBuilder contentBuilder;
        ContentManager contentManager;
        BottomPanal _bottomPanal;


        /// <summary>
        /// Constructs the main form.
        /// </summary>
        public MainForm()

        {
            Initialize();
            
            InitializeComponent();

            Mouse.WindowHandle =
                this.Cursor.Handle;

            new Initializer();
            /*contentBuilder = new ContentBuilder();

            contentManager = new ContentManager(_entry.Services,
                                                contentBuilder.OutputDirectory);

            */
            this.openToolStripMenuItem.Click += OpenMenuClicked;
          
            this.splitContainer2.Panel2.Controls.Add(_bottomPanal);
            this.splitContainer4.Panel2.Controls.Add(this._propertyPanal);
            this.splitContainer4.Panel1.Controls.Add(this._entry);
          
        }
        void Initialize()
        {
            this._entry = new WinFormsContentLoading.SceneEntry();
            this._bottomPanal = new BottomPanal(_entry);
            _propertyPanal = new PropertyPanal(_entry);
           
            // 
            // _entry
            // 
            this._entry.Dock = System.Windows.Forms.DockStyle.Fill;
            this._entry.Location = new System.Drawing.Point(0, 0);
            this._entry.Name = "_entry";
            this._entry.Size = new System.Drawing.Size(642, 407);
            this._entry.TabIndex = 11;
            this._entry.Text = "modelViewerControl";
            // 
            // _propertyPanal
            // 
            this._propertyPanal.ColumnStyles.Add(new System.Windows.Forms.ColumnStyle(System.Windows.Forms.SizeType.Absolute, 20F));
            this._propertyPanal.Location = new System.Drawing.Point(0, 0);
            this._propertyPanal.Name = "_propertyPanal";
            this._propertyPanal.Size = new System.Drawing.Size(200, 100);
            this._propertyPanal.TabIndex = 0;
            


        }
        

        /// <summary>
        /// Event handler for the Exit menu option.
        /// </summary>
        void ExitMenuClicked(object sender, EventArgs e)
        {
            Close();
        }


        /// <summary>
        /// Event handler for the Open menu option.
        /// </summary>
        void OpenMenuClicked(object sender, EventArgs e)
        {
            OpenFileDialog fileDialog = new OpenFileDialog();

            // Default to the directory which contains our content files.
            string assemblyLocation = Assembly.GetExecutingAssembly().Location;
            string relativePath = Path.Combine(assemblyLocation, "..\\Content");
            string contentPath = Path.GetFullPath(relativePath);

            fileDialog.InitialDirectory = contentPath;

            fileDialog.Title = "Load Model";

            fileDialog.Filter = "Model Files (*.fbx;*.x)|*.fbx;*.x|" +
                                "FBX Files (*.fbx)|*.fbx|" +
                                "X Files (*.x)|*.x|" +
                                "All Files (*.*)|*.*";

            if (fileDialog.ShowDialog() == DialogResult.OK)
            {

                new SysEvn(0, OBJTYPE.Model, SYSEVN.New,fileDialog.FileName);
               //LoadModel(fileDialog.FileName);
            }

        }

        private void button10_Click(object sender, EventArgs e)
        {
            if (SelectFunction.Selection.Count == 0)
                return;

            ISelectable scomp=SelectFunction.Selection[0];
            IDrawableComponent dcomp = ((IDrawableComponent)scomp);
            new MoveTool(_entry.Scene, dcomp);
        }

      

        /*
        void LoadModel(string fileName)
        {
            Cursor = Cursors.WaitCursor;

            // Unload any existing model.
            _entry.Model = null;
            contentManager.Unload();

            // Tell the ContentBuilder what to build.
            contentBuilder.Clear();
            contentBuilder.Add(fileName, "Model1", null, "ModelProcessor");
            //contentBuilder.Add("../../../shaders/BloomCombine.fx", "BloomCombine", null, "EffectProcessor");
            //contentBuilder.Add("../../../shaders/BloomExtract.fx", "BloomExtract", null, "EffectProcessor");
            //contentBuilder.Add("../../../shaders/GaussianBlur.fx", "GaussianBlur", null, "EffectProcessor");
           
            string buildError = contentBuilder.Build();

            if (string.IsNullOrEmpty(buildError))
            {
                // If the build succeeded, use the ContentManager to
                // load the temporary .xnb file that we just created.
                _entry.Model = contentManager.Load<Model>("Model1");
               

            }
            else
            {
                // If the build failed, display an error message.
                MessageBox.Show(buildError, "Error");
            }

            Cursor = Cursors.Arrow;
        }
        */


        
    }
}
